// Placeholder for the Remove.bg API key (replace with your actual key from https://www.remove.bg/api)
const apiKey = "YOUR_API_KEY";

// Get references to HTML elements
const imageUpload = document.getElementById('image-upload');
const originalImage = document.getElementById('original-image');
const processedImage = document.getElementById('processed-image');
const previewSection = document.getElementById('preview-section');
const downloadBtn = document.getElementById('download-btn');
const loading = document.getElementById('loading');

// Event listener for when a file is selected
imageUpload.addEventListener('change', function(event) {
    const file = event.target.files[0]; // Get the selected file
    if (file) {
        // Display the original image immediately
        const reader = new FileReader();
        reader.onload = function(e) {
            originalImage.src = e.target.result; // Set the original image source
            previewSection.style.display = 'flex'; // Show the preview section
        };
        reader.readAsDataURL(file); // Read the file as a data URL
        
        // Process the image with the API
        processImage(file);
    }
});

// Function to send the image to Remove.bg API and handle the response
function processImage(file) {
    loading.style.display = 'block'; // Show loading indicator
    downloadBtn.style.display = 'none'; // Hide download button during processing
    
    // Prepare FormData for the API request
    const formData = new FormData();
    formData.append('image_file', file); // Add the image file
    formData.append('size', 'auto'); // Auto size (free tier option)
    
    // Make the API request
    fetch('https://api.remove.bg/v1.0/removebg', {
        method: 'POST',
        headers: {
            'X-Api-Key': apiKey // Include the API key in headers
        },
        body: formData // Send the form data
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('API request failed: ' + response.statusText); // Handle errors
        }
        return response.blob(); // Get the response as a blob (image data)
    })
    .then(blob => {
        // Create a URL for the processed image and display it
        const url = URL.createObjectURL(blob);
        processedImage.src = url;
        
        // Set up the download button
        downloadBtn.style.display = 'inline-block'; // Show download button
        downloadBtn.onclick = function() {
            const link = document.createElement('a'); // Create a temporary link
            link.href = url;
            link.download = 'background_removed.png'; // Set download filename
            link.click(); // Trigger download
        };
        
        loading.style.display = 'none'; // Hide loading indicator
    })
    .catch(error => {
        console.error('Error:', error); // Log errors to console
        alert('An error occurred while processing the image. Please check your API key and try again.'); // Show user-friendly error
        loading.style.display = 'none'; // Hide loading indicator
    });
}